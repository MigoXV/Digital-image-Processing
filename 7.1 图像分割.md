[TOC]

# 7.1 图像分割

## 7.1.1 概述

​        图像分割是将图像划分成若干个互不相交的小区域的过程， 小区域是某种意义下具有共同属性的像素的连通集合。如不同目标物体所占的图像区域、 前景所占的图像区域等。连通是指集合中任意两个点之间都存在着完全属于该集合的连通路径。对于离散图像而言，连通有4连通和8连通之分，如图7-1所示。 

![image-20230329162658738](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230329162658738.png)

图7-1 4连通和8连通

​    4连通指的是从区域上一点出发，可通过4个方向，即上、 下、左、右移动的组合，在不越出区域的前提下，到达区域内的任意像素； 8连通方法指的是从区域上一点出发，可通过左、 右、上、下、左上、右上、左下、右下这8个方向的移动组合来到达区域内的任意像素。

​    图像分割有三种不同的途径：其一是将各像素划归到相应物体或区域的像素聚类方法, 即区域法；其二是通过直接确定区域间的边界来实现分割的边界方法；其三是首先检测边缘像素， 再将边缘像素连接起来构成边界形成分割。在图像分割技术中， 最常用的是利用阈值化处理进行的图像分割。 

## 7.1.2 灰度阈值法分割

常用的图像分割方法是把图像灰度分成不同的等级, 然后 用设置灰度门限 (阈值) 的方法确定有意义的区域或分割物体 的边界。常用的阈值化处理就是图像的二值化处理, 即选择一阈值, 将图像转换为黑白二值图像, 用于图像分割及边缘跟踪 等预处理。

图像阈值化处理的变换函数表达式为

$$
g(x, y)= \begin{cases}0 & f(x, y)<T \\ 255 & f(x, y) \geq T\end{cases}
$$

或
$$
g(x, y)= \begin{cases}1 & f(x, y) \leq t \\ 0 & f(x, y) \geq t\end{cases}
$$
或
$$
g(x, y)=\left\{\begin{array}{lr}
1 & t_1 \leq f(x, y) \leq t_2 \\
0 & \text { 其它 }
\end{array}\right.
$$




<img src="https://cdn.mathpix.com/cropped/2023_03_28_fadf0bb279ca899c9bb6g-07.jpg?height=1015&width=1260&top_left_y=312&top_left_x=684" style="zoom: 33%;" />

图7-2 阈值变换曲线

在图像的阈值化处理过程中， 选用不同的阈值其处理结果差异很大。如图7-3所示, 阈值过大, 会提取多余的部分; 而 阈值过小, 又会丢失所需的部分（注意: 当前背景为黑色, 对象为白色时刚好相反）。因此, 阈值的选取非常重要。

图7-3(a)原始图像的直方图如图7-4所示。分析该直方图可 知, 该直方图具有双峰特性, 图像中的目标 (细胞) 分布在较 暗的灰度级上形成一个波峰, 图像中的背景分布在较亮的灰度 级上形成另一个波峰。此时, 用其双峰之间的谷低处灰度值作 为阈值 $T$ 进行图像的阈值化处理, 便可将目标和背景分割开来。 

<img src="https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230329163439909.png" alt="image-20230329163439909" style="zoom:50%;" />

图7-3 不同阈值对阈值化结果的影响
(a) 原始图像;
(b) 阈值 $\mathrm{T}=91$;
(c) 阈值 $\mathrm{T}=130$;
(d) 阈值 $T=43$ 

![image-20230329163518090](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230329163518090.png)

图7-4 图7-3(a)所示图像的直方图 

   为了有效地分割物体与背景，人们发展了各种各样的阈值处理技术，包括全局阈值、自适应阈值、最佳阈值等等。从方法分有:直方图阈值分割法, 类间方差阈值分割法,二维熵值分割法,模糊阈值分割法,共生矩阵阈值分割法.


 - 全局阈值
全局阈值是指整幅图象使用同一个阈值做分 割处理。适用于背景和前景有明显对比的图象。 例如当直方图明显呈现双峰情况时, 可以选择两 个峰值的中点作为全局阈值。 

- 自适应阈值
在许多情况下, 物体和背景的对比度在图象 中不是各处一样的, 这时很难用统一的一个阈值 将物体与背景分开。这时可以根据图象的局部特 征分别采用不同的阈值进行分割。实际处理时, 需要按照具体问题将图象分成若干子区域分别选 择阈值, 或者动态地根据一定的邻域范围选择每 点处的阈值, 进行图象分割。

- 最佳阈值
最佳阈值是使图像中目标与背景分割错误最小的阈值。

1.直方图阈值分割法 

1)简单直方图分割法 

基本原理: 直方图明显呈现双峰情况时，可以 选择两个峰值的中点作为阈值.
![](https://cdn.mathpix.com/cropped/2023_03_28_fadf0bb279ca899c9bb6g-13.jpg?height=668&width=2282&top_left_y=922&top_left_x=96)

![image-20230329163751193](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230329163751193.png)


2) 最佳阈值

设一幅图像只由目标和背景组成,其灰度分布概率 密度 $P_{1}(\mathbf{z})$ 和 $\mathbf{P}_{2}(\mathbf{z})$ 为正态分布,且已知目标像素占全图像 像素比为 $\theta$ :

$\mathrm{p}$

![](https://cdn.mathpix.com/cropped/2023_03_28_fadf0bb279ca899c9bb6g-15.jpg?height=587&width=1311&top_left_y=861&top_left_x=531)



$$
P_{1}(Z)=\frac{1}{\sqrt{2 \pi \sigma_{1}}} \exp \left[-\frac{\left(Z-\mu_{1}\right)^{2}}{2 \sigma_{1}{ }^{2}}\right]
$$

$$
P_{2}(Z)=\frac{1}{\sqrt{2 \pi \sigma_{2}}} \exp \left[-\frac{\left(Z-\mu_{2}\right)^{2}}{2 \sigma_{2}{ }^{2}}\right]
$$

则阈值为:

$$
Z_{t}=\frac{\mu_{1}+\mu_{2}}{2}+\frac{\sigma^{2}}{\mu_{1}-\mu_{2}} \ln \left(\frac{1-\theta}{\theta}\right)
$$

若 $\theta=0.5$

则阈值为:

$$
Z_{t}=\frac{\mu_{1}+\mu_{2}}{2}
$$



2.类间方差阈值分割法 

设一幅图像只由目标和背景组成,原图灰度级为} $\mathrm{L}$, 灰度级为 $\mathrm{i}$ 的像素点数为 $n_{\mathrm{i}}$, 图像总像素点数为 $\mathrm{N}$, 则:
$$
p_{i}=\frac{n_{i}}{N}
$$

用阈值 $\mathrm{t}$ 将图像分割为两类: $\mathrm{C}_{1}=(0,1,2, \ldots, \mathrm{t})$ 和 $\mathrm{C}_{2}$ $=(\mathbf{t}, \mathbf{t}+1, \mathbf{t}+2, \ldots, \mathbf{L}-1)$, 则有：



$$
\begin{aligned}
& \omega_{1}=P_{r}\left(C_{1}\right)=\sum_{i=0}^{t} p_{i} \\
& \omega_{2}=P_{r}\left(C_{2}\right)=\sum_{i=t+1}^{L-1} p_{i} \\
& \mu_{1}=\sum_{i=0}^{t} i p_{i} / \omega_{1} \\
& \mu_{2}=\sum_{i=t+1}^{L-1} i p_{i} / \omega_{2} \\
& \sigma_{1}^{2}=\sum_{i=0}^{t}\left(i-\mu_{1}\right)^{2} p_{i} / \omega_{1} \\
& \sigma_{2}^{2}=\sum_{i=t+1}^{L-1}\left(i-\mu_{2}\right)^{2} p_{i} / \omega_{2}
\end{aligned}
$$

类内方差:

$$
\sigma_{\omega}^{2}=\omega_{1} \sigma_{1}^{2}+\omega_{2} \sigma_{2}^{2}
$$

类间方差:

$$
\sigma_{B}^{2}=\omega_{1} \omega_{2}\left(\mu_{1}-\mu_{2}\right)^{2}
$$

总方差:

$$
\sigma_{\omega}^{2}=\sigma_{B}^{2}+\sigma_{\omega}^{2}
$$

定义准则函数:

$$
F(t)=\sigma_{B}^{2} / \sigma_{T}^{2}
$$



则使 $F(t)$ 最大的 $t$ 为最佳阈值.

![](https://cdn.mathpix.com/cropped/2023_03_28_fadf0bb279ca899c9bb6g-20.jpg?height=845&width=1208&top_left_y=445&top_left_x=525)

图 6.3.6 坦克图类间方差阈值分割 

3二维熵值分割法

一维熵值分割法 设原图灰度级为 $L$, 灰度级为 $i$ 的像素点数为 $n_{i}$, 图像总像素点数为 $\mathbf{N} \times \mathbf{N}$,则:

$$
p_{i}=\frac{n_{i}}{N \times N}
$$

设图中灰度级低于 $\mathrm{t}$ 的像素点构成目标区 域O, 灰度级高于 $\mathbf{t}$ 的像素点构成背景区域B, 则目标区域和背景区域的熵定义为:

$H_{0}(t)=-\sum_{i}\left(p_{i} / p_{t}\right) \lg \left(p_{i} / p_{t}\right) \quad i=1,2,3 \cdots t$

$$
H_{B}(t)=-\sum_{i}\left[p_{i} /\left(1-p_{t}\right)\right] \lg \left[p_{i} /\left(1-p_{t}\right)\right] \quad i=t+1, t+2, t+3 \cdots L-1
$$

贝则熵函数定义为:

$$
\varphi(t)=H_{0}+H_{B}=\lg p_{t}\left(1-p_{t}\right)+\frac{H_{t}}{p_{t}}+\frac{H_{L}-H_{t}}{1-p_{t}}
$$

其中:

$$
\begin{array}{cc}
H_{t}=-\sum_{i} p_{i} \lg p_{i} & i=1,2, \cdots t \\
H_{L}=-\sum_{i} p_{i} \lg p_{i} & i=1,2 \cdots L
\end{array}
$$

当熵函数最大时的灰度值t就为最佳阈值.



4.模糊阈值分割

1)隶属函数 $\mu\left(\mathrm{x}_{\mathrm{m}, \mathrm{n}}, \mathrm{p}, \mathbf{q}\right)$ :

设像素点 $(m, n)$ 的灰度值为 $x_{m, n}$, 则 $\mu\left(x_{m, n}, p, q\right)$ 定义 为像素点 $(\mathrm{m}, \mathbf{n})$ 属于目标的程度;

$$
\mu\left(x_{m, n}, p, q, r\right)=\left\{\begin{array}{cc}
0 & x_{m, n} \leq p \\
2\left[\left(x_{m, n}-p\right) /(r-p)\right]^{2} & p \leq x_{m, n} \leq q \\
1-2\left[\left(x_{m, n}-p\right) /(r-p)\right]^{2} & q_{m, n}<x \leq r \\
1 & x \geq r
\end{array}\right.
$$

或
$$
\mu\left(x_{m, n}, p, q, r\right)=\left\{\begin{array}{cc}
0 & x_{m, n} \leq p \\
\dfrac{K\left(x_{m, n}-p\right)^{2}}{1+K\left(x_{m, n}-p\right)^{2}} & p<x_{m, n} \leq q \\
1 & x_{m, n}>q
\end{array}\right. \\
$$
或
$$
\mu\left(x_{m, n}, p, q, r\right)=\left\{\begin{array}{cc}
0 & x_{m, n} \leq p \\
\dfrac{\left(x_{m, n}-p\right)}{q-p} & p<x_{m, n} \leq q \\
1 & x_{m, n}>q
\end{array}\right.
$$
其中 $\mathbf{q}$ 为阈值, 显然灰度值越大, 隶属函数 $\mu\left(\mathrm{x}_{\mathrm{m}, \mathrm{n}}, p, q\right)$ 越大, 该点 $(\mathbf{m}, \mathbf{n})$ 属于目标的程度, 即该点越可能是目标上 的点,否则该点越可能是背景上的点.



2 ）模糊率、模糊熵:

模糊率

$$
V(q)=\frac{2}{M N} \sum_{m} \sum_{n} \min \left[\mu\left(x_{m, n}, q\right), 1-\mu\left(x_{m, n}, q\right)\right]
$$

模糊熵

$$
\begin{aligned}
& E(q)=\frac{1}{M N \ln 2} \sum_{m} \sum_{n} S_{n}\left[\mu\left(x_{m, n}, q\right)\right] \\
& S_{n}\left[\mu\left(x_{m, n}, q\right)\right]=-\mu\left(x_{m, n}, q\right) \ln \mu\left(x_{m, n}, q\right)-\left(1-\mu\left(x_{m, n}, q\right) \ln \left(1-\mu\left(x_{m, n}, q\right)\right)\right.
\end{aligned}
$$

3）模糊阈值

当模糊率或模糊熵最大时的灰度值 $\mathbf{q}$ 就为最佳阈值.}



<img src="https://cdn.mathpix.com/cropped/2023_03_28_fadf0bb279ca899c9bb6g-26.jpg?height=1062&width=1515&top_left_y=241&top_left_x=499" style="zoom:50%;" />

图 6.3.13 坦克图模糊阈值法分割 

## 7.1.3 区域生长

分割的目的是把一幅图像划分成一些区域，最直接的方法就是把一幅图像分成满足某种判据的区域，也就是说，把点组成区域。为了实现分组, 首先要确定区域的数目, 其次要确定一个区域与其他区域相区别的特征, 最后还要产生有意义分割的相似性判据。

分割区域的一种方法叫区域生长或区域生成。假定区域的数目以及在每个区域中单个点的位置已知, 则从一个已知点开 始，加上与已知点相似的邻近点形成一个区域。相似性准则可以是灰度级、 彩色、组织、梯度或其他特性，相似性的测度 可以由所确定的阈值来判定。方法是从满足检测准则的点开始， 在各个方向上生长区域, 当其邻近点满足检测准则就并入小块 区域中。当新的点被合并后再用新的区域重复这一过程, 直到 没有可接受的邻近点时生成过程终止。 

图 7-5给出一个简单的例子。此例的相似性准则是邻近点的灰度级与物体的平均灰度级的差小于2。图中被接受的点和起始点均用下划线标出，其中（a）图是输入图像;（b）图是第一步接受的邻近点;（c）图是第二步接受的邻近点;(d) 图是从6开始生成的结果。 

![image-20230329164234265](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230329164234265.png)

图7-5 区域生长示例 

当生成任意物体时，接收准则可以结构为基础, 而不是以灰度级或对比度为基础。为了把候选的小群点包含在物体中,可以检测这些小群点, 而不是检测单个点, 如果它们的结构与物体的结构足够相似时就接受它们。 

## ７.1.4 区域聚合

区域聚合可直接用于图像分割, 它要求聚合中的各个点必 须在平面上相邻接而且特性相似。区域聚合的步骤是首先检查 图像的测度集，以确定在测度空间中聚合的位置和数目，然后 把这些聚合的定义用于图像, 以得到区域聚合。区域聚合技术 可以说明如下。

首先, 在图片上定义某个等价关系。例如, 最简单的等价 关系可定义为 $p(i, j)=p(k, l)$ 。也就是说, 如果 $p(i, j)=p(k, l)$, 就说明 $p(i, j)$ 与 $p(k, l)$ 等价。任何在点的格子上的等价关系又可划 分为等价类。例如, $p(i, j)$ 的取值范围为 0 到 63 , 就可以产生 64 个 等价类的模板。如果关系满足，它的值等于 1 ，否则为 0 。

模板的图像是两两不相交的, 那么64个模板就会充满整个格 子。这些等价的类又可进一步分为最大连接的子集（连接分 量）。连接性可以用点 $(i, j)$ 的邻点来定义, 如4连通邻点、8连 通邻点等等。假如 $R$ 是属于格子的子集, 在 $R$ 中存在一个点序列, 第一个点是 $p_{1}$, 最后一个点是 $p_{2}$, 属于格子的子集 $R$ 的两个点 $p_{1}$ 和 $p_{2}$ 是被连接起来的, 这样, 相继的各点是 4 连接相邻的。通过 这样的连接关系可以定义一个属于 $R$ 的子集, 这个子集形成一个 区域, 在这个区域中, 任何点都与 $R$ 有关。利用等价模板可分成 最大的连接区域, 然后, 这些最大的连接区域又可以像搭积木 一样形成有意义的分割。 

1970年布莱斯和芬尼玛提出一种分割方法, 如图5-6所示。图 ( $a$ ) 是具有灰度级的 $3 \times 3$ 的 $G$ 阵列, 图 (b) 是对 $G$ 的分割结果。 其中, 图像格子为 $G$, 它是大格子 $S$ 的子格子。 $G$ 为 $n \times m$ 的格子, $S$ 是 $(2 n+1) \times(2 m+1)$ 的大格子。在大格子中, $G(i, j)$ 点位 于 $S$ 的 $(2 i+1,2 j+1)$ 点上。 $G$ 中的点与 $S$ 中的点相对应, 其中每一下 标都是奇数, 其余的点用来代表区域的边界。以这种形式表现 的区域, 产生一种寻找最大连接区域的方法。G中的点与它上边 和右边的点相比较, 灰度级相同就合并, 灰度级不同就揷入边界 线。把图像中的每个点都处理过之后, 整个图像就被分割成区域。 在这个例子中, 由于采用了4连通等价关系, 因此, 由图可见, 在对角线方向上的等灰度级产生了隔开的区域。 

![image-20230329164903486](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230329164903486.png)

图７-6 布莱斯和芬尼玛分割方法 

2 分裂合并法

实际中常先把图像分成任意大小且不重叠的区域，然后再合并或分裂这些区域以满足分割的要求, 即分裂合并法. 一致性测度可以选择基于灰度统计特征 (如同质区域中的方差)，假设阈值为 $T$, 则算法步骤为:

(1) 对于任一 $R_{i}$, 如果 $V\left(R_{i}\right)>T$ ，则将其分裂成互不重叠的四等分;

(2) 对相邻区域 $R_{i}$ 和 $R_{j}$, 如果 $\boldsymbol{V}\left(\boldsymbol{R}_{i} \bigcup_{j} \boldsymbol{R}\right)<T$, 则将二者合并;

(3) 如果进一步的分裂或合并都不可能了, 则终止算法。 

2 分裂合并法

![image-20230329164936784](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230329164936784.png)



