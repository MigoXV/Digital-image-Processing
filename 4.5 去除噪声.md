[TOC]

## 4.5 去除噪声

改善降质图像的方法有两类：

一类是不考虑图像降质的原因， 只将图像中感兴趣的部分加以处理或突出有用的图像特征，故改 善后的图像并不一定要去逼近原图像。这一类图像改善方法称为 图像增强，主要目的是要提高图像的可懂度。

> 通过图像增强的方法提高图像质量，这一类方法称之为黑盒子办法.不去了解内部机理,只研究输入和输出

另一类方法是针对 图像降质的具体原因，设法补偿降质因素，使改善后的图像尽可 能地逼近原始图像。这类方法称为图像恢复或图像复原技术

图像增强处理的方法基本上可分为空间域法和频率法两大 类。前者是在原图像上直接进行数据运算，对像素的灰度值进 行处理。它又分为两类，一类是对图像作逐点运算，称为点运 算；另一类是在与处理像点邻域有关的空间域上进行运算， 称 为局部运算。频域法是在图像的变换域上进行处理， 增强感兴 趣的频率分量， 然后进行反变换， 得到增强了的图像

> 图像恢复则被称之为白盒子办法,需要了解内部机理

## 4.5.1 模板操作和卷积运算

<font color="pink">超重点:模板匹配法,掌握则保证85分</font>

模板操作(前提:空域)是数字图像处理中常用的一种运算方式，图像的平 滑、锐化以及后面将要讨论的细化、边缘检测等都要用到模板操 作。例如， 有一种常见的平滑算法是将原图中的一个像素的灰度 值和它周围邻近8个像素的灰度值相加，然后将求得的平均值作 为新图像中该像素的灰度值。可用如下方法来表示该操作：
$$
\frac{1}{9}\left[\begin{array}{ccc}
1 & 1 & 1 \\
1 & 1 * & 1 \\
1 & 1 & 1
\end{array}\right]
$$

> 星号是代替的意思

上式有点类似于矩阵，通常称之为模板（Template），带星 号的数据表示该元素为中心元素，即这个元素是将要处理的元 素。如果模板为
$$
\frac{1}{9}\left[\begin{array}{ccc}
1 * & 1 & 1 \\
1 & 1 * & 1 \\
1 & 1 & 1
\end{array}\right]
$$
则该操作的含义是：将原图中一个像素的灰度值和它右下相 邻近的8个像素值相加，然后将求得的平均值作为新图像中该像 素的灰度值

模板操作实现了一种邻域运算，即某个像素点的结果不仅和 本像素灰度有关，而且和其邻域点的值有关。模板运算的数学含 义是卷积（或互相关）运算。 卷积是一种用途很广的算法，可用卷积来完成各种处理变换， 图4-17说明了卷积的处理过程

![image-20230328165413026](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230328165413026.png)

图4-17 卷积运算示意图

卷积运算中的卷积核就是模板运算中的模板，卷积就是作加权求和的过程。邻域中的每个像素（假定邻域为3×3大小，卷积核大小与邻域相同），分别与卷积核中的每一个元素相乘，乘积求和所得结果即为中心像素的新值。卷积核中的元素称作加权系数（亦称为卷积系数），卷积核中的系数大小及排列顺序， 决定了对图像进行区处理的类型。改变卷积核中的加权系数， 会影响到总和的数值与符号， 从而影响到所求像素的新值。 

在模板或卷积的加权运算中，还存在一些具体问题需要解决：首先是图像边界问题，当在图像上移动模板（卷积核）至图像的边界时，在原图像中找不到与卷积核中的加权系数相对应的9个像素，即卷积核悬挂在图像缓冲区的边界上， 这种现象在图像的上下左右四个边界上均会出现。例如，当模板为 
$$
\frac{1}{9}\left[\begin{array}{ccc}
1  & 1 & 1 \\
1 & 1 * & 1 \\
1 & 1 & 1
\end{array}\right]
$$
设原图像为 
$$
\left[\begin{array}{lllll}
1 & 1 & 1 & 1 & 1 \\
2 & 2 & 2 & 2 & 2 \\
3 & 3 & 3 & 3 & 3 \\
4 & 4 & 4 & 4 & 4
\end{array}\right]
$$
经过模板操作后的图像为 
$$
\left[\begin{array}{ccccc}
- & - & - & - & - \\
- & 2 & 2 & 2 & - \\
- & 3 & 3 & 3 & - \\
- & - & - & - & -
\end{array}\right]
$$
“－”表示无法进行模板操作的像素点。

解决这个问题可以采用两种简单方法：一种方法是忽略图像边界数据， 另一种方法是在图像四周复制原图像边界像素的值，从而使卷积核悬挂在图像四周时可以进行正常的计算。实际应用中，多采用第一种方法。

其次，是计算出来的像素值的动态范围问题， 对此可简单地将其值置为0或255即可。 

## 4.5.2 邻域平均法

邻域平均法是一种利用Box模板对图像进行模板操作（卷积运算）的图像平滑方法，所谓Box模板是指模板中所有系数都取相同值的模板， 常用的3×3和5×5模板如下： 
$$
\frac{1}{9}\left[\begin{array}{ccc}
1  & 1 & 1 \\
1 & 1 * & 1 \\
1 & 1 & 1
\end{array}\right]
$$

$$
\frac{1}{25}\left[\begin{array}{ccc}
1  & 1 & 1 & 1&1 \\
1  & 1 & 1 & 1&1 \\
1  & 1 & 1* & 1&1 \\
1  & 1 & 1 & 1&1 \\
1  & 1 & 1 & 1&1 \\
\end{array}\right]
$$

Box模板对当前像素及其相邻的的像素点都一视同仁，统一进行平均处理， 这样就可以滤去图像中的噪声。例如，用3×3 Box模板对一幅数字图像处理结果，如图4-18所示（图中计算结果按四舍五入进行了调整，对边界像素不进行处理）。
$$
\begin{array}{|c|c|c|c|c|}
\hline 1 & 2 & 1 & 4 & 3 \\
\hline 1 & 2 & 2 & 3 & 4 \\
\hline 5 & 7 & 6 & 8 & 9 \\
\hline 5 & 7 & 6 & 8 & 8 \\
\hline 5 & 6 & 7 & 8 & 9 \\
\hline
\end{array}\Rightarrow
\begin{array}{|c|c|c|c|c|}
\hline 1 & 2 & 1 & 4 & 3 \\
\hline 1 & 3 & 4 & 4 & 4 \\
\hline 5 & 4 & 5 & 6 & 9 \\
\hline 5 & 6 & 7 & 8 & 8 \\
\hline 5 & 6 & 7 & 8 & 9 \\
\hline
\end{array}
$$
图4-18 3×3Box模板平滑处理示意图 

邻域平均法的数学含义可用下式表示：
$$
g(x, y)=\frac{1}{M} \sum_{(i, j) \in s} f(i, j)\tag{4-17}
$$
式中: $x, y=0,1, \ldots, N-1 ; S$ 是以 $(x, y)$ 为中心的邻域的集合, $M$ 是 $S$ 内的点数。

邻域平均法的思想是通过一点和邻域内像素点求平均来去除突变的像素点，从而滤掉一定的噪声，其主要优点是算法简单，计算速度快， 但其代价是会造成图像一定程度上的模糊。

采用邻域平均法对图4-19(*a*)中的图像进行处理后的结果如图4-19(*b*)所示。可以看出经过邻域平均法处理后，虽然图像的噪声得到了抑制，但图像变得相对模糊了。

![image-20230328165858329](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230328165858329.png)

图4-19 图像的领域平均法

(a) 原始图像； (b) 邻域平均后的结果

邻域平均法的平滑效果与所采用邻域的半径（模板大小）有关。半径愈大， 则图像的模糊程度越大， 因此， 减少图像的模糊是图像平滑处理研究的主要问题之一。

为解决邻域平均法造成图像模糊的问题，可采用阈值法、K邻点平均法、梯度倒数加权平滑法、 最大均匀性平滑法、小斜面模型平滑法等。它们讨论的重点都在于如何选择邻域的大小、 形状和方向，如何选择参加平均的点数以及邻域各点的权重系数等。有关这些方法请参阅相关参考文献。 

### 具有边界保持的平滑滤波器

1. 设计思想：

   前面的处理结果可知，经过平滑滤波处理之后，图像会变得模糊。分析原因，在图像上的景物之所以可以辨认清楚是因为目标物之间存在边界。

这类滤波器是增加了一个判别当前像素点平滑时，选择非边界点进行。

2. K近邻均值（中值）滤波器

1） 以待处理像素为中心，作一个m*m的作用模板。

2） 在模板中，选择K个与待处理像素的灰度差为最小的像素。

3） 将这K个像素的灰度均值（中值）替换掉原来的像素值。

例：3*3模板，k=5

![image-20230328170058303](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230328170058303.png)

## 4.5.3 中值滤波

中值滤波是一种非线性信号处理方法，与其对应的中值滤波器也就是一种非线性滤波器。中值滤波器于1971年提出并应用在一维信号时间序列分析中， 后来被二维图像信号处理技术所引用。它在一定条件下，可以克服线性滤波器（如邻域平滑滤波等）所带来的图像细节模糊，而且对滤除脉冲干扰及图像扫描噪声最为有效。在实际运算过程中并不需要图像的统计特性，这也带来不少方便。但是对一些细节多，特别是点、线、尖顶细节多的图像不宜采用中值滤波。

由于中值滤波是一种非线性运算，对随机输入信号的严格数学分析比较复杂，下面采用直观方法简要介绍中值滤波的原理。 

### 中值滤波原理

中值滤波就是用一个奇数点的移动窗口， 将窗口中心点的值用窗口内各点的中值代替。假设窗口内有五点，其值为80、 90、 200、 110和120， 那么此窗口内各点的中值即为110。

设有一个一维序列 $f_1, f_2, \ldots, f_n$, 取窗口长度 (点数) 为 $m(m$ 为奇数), 对其进行中值滤波, 就是从输入序列中相继抽出 $m$ 个 数 $f_{i-v}, \ldots, f_{i-1}, f_i, f_{i+1}, \ldots, f_{i+v}$ (其中 $f_i$ 为窗口中心点值, $v=(m-1) / 2$ ), 再将这 $m$ 个点按其数值大小排序, 取其序号为中心点的那个数作 为滤波输出。用数学公式表示为
$$
y_i=\operatorname{Med}\left\{f_{i-v}, \Lambda, f_i, \Lambda f_{i+v}\right\} \quad i \in N, v=\frac{m-1}{2}\tag{4-18}
$$
例如, 有一序列 $\{0,3,4,0,7\}$, 重新排序后为 $\{0,0,3,4,7\}$, 则Med $\{0,0,3,4,7\}=3$ 。此列若用平滑滤波, 窗口也是取 5 , 那么平 滑滤波输出为 $(0+3+4+0+7) / 5=2.8$ 。
图4-20使用内含 5 个像素的窗口对离散阶跃函数、斜坡函数、 脉冲函数以及三角形函数进行中值滤波和平均值滤波的示例。 左边一列为原波形, 中间为平均值滤波结果, 右边为中值滤波 结果。可以看出, 中值滤波器不影响阶跃函数和斜坡函数。周 期小于 $m / 2$ (窗口之半) 的脉冲受到抑制, 另外三角函数的顶部 变平。

![image-20230423195415339](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230423195415339.png)

图4-20 中值滤波和平均值滤波比较
（a） 阶跃；（b）斜坡；（c）单脉冲；（d）双脉冲；（e）三脉冲； （f）三角波  

二维中值滤波可由下式表示： 
$$
y_{i j}={Med}_A\left\{f_{i j}\right\}\tag{4-19}
$$
式中: $A$ 为窗口; $\left\{f_{i i}\right\}$ 为二维数据序列。

二维中值滤波的窗口形状和尺寸对滤波效果影响较大，不同的图像内容和不同的应用要求，往往采用不同的窗口形状和尺寸。常用的二维中值滤波窗口有线状、方形、圆形、十字形以及圆环形等。窗口尺寸一般先用3×3，再取5×5逐渐增大， 直到滤波效果满意为止。就一般经验来讲，对于有缓变的较长轮廓线物体的图像，采用方形或圆形窗口为宜。对于包含有尖顶物体的图像， 用十字形窗口， 而窗口大小则以不超过图像中最小有效物体的尺寸为宜。如果图像中点、线、尖角细节较多，则不宜采用中值滤波。 

### 中值滤波主要特性

1) 对某些输入信号中值滤波的不变性
对某些特定的输入信号, 如在窗口内单调增加或单调减少的 序列, 中值滤波输出信号仍保持输入信号不变, 即： $f_{i-}$ ${ }_n \leq \ldots \leq f_i \leq \ldots \leq f_{i+n}$ 或 $f_{i-n} \geq \ldots \geq f_i \geq \ldots \geq f_{i+n}$, 则 $\left\{y_i\right\}=\left\{f_i\right\}$
一维中值滤波这种不变性可以从图4-20中 $(a)$ 和 $(b)$ 上看出来。 二维中值滤波的不变性如图4-21所示。它不但与输入信号有关, 而且还与窗口形状有关。图4-22给出了几种二维窗口及与之对应 的最小尺寸的不变输入图形。一般与窗口对顶角连线垂直的边缘 线保持不变性。利用这个特点, 可以使中值滤波既能去除图像中 的噪声, 又能保持图像中一些物体的边缘。

---

![image-20230328171136466](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230328171136466.png)

图4-21 中值滤波不变性示例

(a) 原始图像;(b) 中值滤波输出 

![image-20230328171200177](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230328171200177.png)

图4-22 中值滤波几种常用窗口及其相应的不变图形 

对于一些周期性的数据序列，中值滤波也存在着不变性。

例如，下列一维周期性二值序列

$$
\left\{f_{i}\right\}=\ldots,+1,+1,-1,-1,+1,+1,-1,-1, \ldots
$$

若设窗口长度为 9 , 则中值滤波对此序列保持不变性。对于二维 周期序列不变性, 如周期网状结构图案, 分析起来就更复杂了, 可以通过试验改变窗口形状和尺寸来获取。 

2）中值滤波去噪声性能

对于零均值正态分布的噪声输入, 中值滤波输出的噪声方 差 $\sigma^{2}{ }_{\text {med }}$ 近似为

$$
\sigma_{m e d}^{2}=\frac{1}{4 m f^{2}(\bar{m})} \approx \frac{\sigma_{i}^{2}}{m+\frac{\pi}{2}-1} \cdot \frac{\pi}{2}\tag{4-20}
$$

式中: $\sigma_{i}^{2}$ 为输入噪声功率 (方差) , $m$ 为中值滤波窗口长度 (点数) , $\bar{m}$ 为输入噪声均值, $f(\bar{m})$ 为输入噪声密度函数。 

而均值滤波的输出噪声方差 $\sigma^{2}{ }_{0}$ 为
$$
\sigma_{0}^{2}=\frac{1}{m} \sigma_{i}^{2}\tag{4-21}
$$

比较公式(4-20)和(4-21), 可以看出, 中值滤波的输出与输 入噪声的密度分布有关。对随机噪声的抑制能力, 中值滤波比 平均值滤波要差一些。但对脉冲干扰, 特别是脉冲宽度小于 $m$ / 2、相距较远的窄脉冲干扰，中值滤波的效果较好。 

3）中值滤波的频谱特性

设 $G$ 为输入信号频谱, $F$ 为输出信号频谱, 定义中值滤波的 频率响应特性为

$$
H=\left|\frac{G}{F}\right|\tag{4-22}
$$

试验表明, $H$ 与 $G$ 的关系曲线如图4-23所示。由图可见, 中 值滤波频谱特性起伏不大, 其均值比较平坦。可以认为信号经 中值滤波后, 频谱基本不变。这一特点对设计和使用中值滤波 器很有意义。 

<img src="https://cdn.mathpix.com/cropped/2023_03_28_72c9a82f7cea0364a76eg-07.jpg?height=871&width=1811&top_left_y=368&top_left_x=332" style="zoom:50%;" />

图4-23 $H$ 与 $G$ 的关系曲线

在计算机上制作了一组用于平滑实验的图像, 如图4-24所示。图(d)和(e)分别是采用 $3 \times 3$ 窗口算术平均平滑去除噪声后的图像,图(f)和(g)分别是采用 $5 \times 5$ 十字中值滤波后的图像。显然, 算术平均平滑对含有高斯噪声的图像有效; 而中值滤波对含有椒盐噪声图像的去噪声效果较好。 

![image-20230328171345472](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230328171345472.png)

图4-24 噪声平滑实验图像
 （a）Lena原图; (b) 高斯噪声; (c) 椒盐噪声; (d) 对(b)平均平滑; (e) 对(c)平均平滑; (f) 对(b) $5 \times 5$ 中值滤波; (g) 对(c) $5 \times 5$ 中值滤波 

### 复合型中值滤波

对一些内容复杂的图像, 可以使用复合型中值滤波。如, 中 值滤波线性组合、高阶中值滤波组合、加权中值滤波以及迭代 中值滤波等。

\section{（1）中值滤波的线性组合是将几种窗口尺寸大小和形状不同} 的中值滤波器复合使用, 只要各窗口都与中心对称, 滤波输出 可保持几个方向上的边缘跳变, 而且跳变幅度可调节。其线性 组合方程如下:

$$
Y_{i j}=\max _{k}\left[A_{A_{k}} {Med}\left\{f_{i j}\right\}\right]\tag{4-23}
$$

式中: $A_{k}$ 为窗口。

（2） 高阶中值滤波组合如下式所示:

$$
Y_{i j}=\sum_{k=1}^{N} a_{k} {Med}_{A_{k}}\left\{f_{i j}\right\}\tag{4-24}
$$

式中: $a_{k}$ 为不同中值滤波的系数, $A_{k}$ 为窗口。

这种中值滤波可以使输入图像中任意方向的细线条保持不变。例如，可选择图4-25中的4种线状窗口 $A_{1} \sim A_{4}$, 用式(4-24)组 合的中值滤波, 可以使输入图像中各种方向的线条保持不变, 而 且又有一定的噪声平滑性能。 

![image-20230328171523765](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230328171523765.png)

图4-25 几种线性窗口 

（3）其他类型的中值滤波: 为了在一定的条件下尽可能去除噪声, 又有效保持图像细节, 可以对中值滤波器参数进行修 正, 如加权中值滤波, 也就是对输入窗口进行加权。也可以是 对中值滤波器的使用方法进行变化, 保证滤波的效果, 还可以 和其他滤波器联合使用。 

### 4.5.4 其他去噪技术

1. 空间域低通滤波

从信号频谱角度来看, 信号的缓慢变化部分在频率域属于

低频部分, 而信号的迅速变化部分在频率域是高频部分。对图 像来说, 它的边缘以及噪声干扰的频率分量都处于频率域较高 的部分, 因此, 可以采用低通滤波的方法来去除噪声。而频域 的滤波又很容易从空间域的卷积来实现, 为此只要适当设计空 间域的单位冲激响应矩阵, 就可以达到滤除噪声的效果。下面 是几种用于噪声平滑低通卷积模板。 

$$
\frac{1}{4}\left[\begin{array}{ccc}0 & 1 & 0 \\ 1 & 0 * & 1 \\ 0 & 1 & 0\end{array}\right]\quad\quad
\frac{1}{8}\left[\begin{array}{ccc}0 & 1 & 0 \\ 1 & 0 * & 1 \\ 1 & 1 & 1\end{array}\right]\quad\quad
\frac{1}{10}\left[\begin{array}{ccc}1 & 1 & 1 \\ 1 & 2 * & 1 \\ 1 & 1 & 1\end{array}\right]
$$
这些模板中引入了加权系数，以区分邻域中不同位置像素对 输出像素值的影响, 常称其为加权模板。与邻域平均法中采用的 Box模板相比较可知，Box模板并没有考虑邻域中各点位置的影 响，对于所有的邻点都一视同仁，所以其平滑的效果并不理想。 

另外, 二维Gaussian离散模板也是一种常用的低通卷积模板。 由于Gaussian函数有着一些良好的特性, 对二维连续Gaussian分 布经采样、量化, 并使模板归一化, 便可得到二维Gaussian离散 模板。3×3二维Gaussian模板如下:
$$
\frac{1}{16}\left[\begin{array}{ccc}
1 & 2 & 1 \\
2 & 4^{*} & 2 \\
1 & 2 & 1
\end{array}\right]
$$

可见Gaussian离散模板也是一种加权模板, 并且它是按二维 正态分布进行加权的。 

2. 频率域低通滤波

利用卷积定理, 可以把式(4-10)写成以下形式:

$$
G(u, v)=H(u, v) F(u, v)\tag{4-25}
$$

式中: $F(u, v)$ 是含噪声图像的傅立叶变换, $G(u, v)$ 是平滑后图像 的傅立叶变换, $H(u, v)$ 是低通滤波器传递函数。

利用 $H(u, v)$ 使 $F(u, v)$ 的高频分量得到衰减, 得到 $G(u, v)$ 后再经 过反变换就得到所希望的图像 $g(x, y)$ 。低通滤波平滑图像的系统 框图如图4-26所示。 

![image-20230423195944002](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230423195944002.png)

图4-26 低通滤波平滑图像的系统框图

​    常用的频率域低通滤波器有：理想低通滤波器（ILPF）、 巴特沃思低通滤波器（BLPF）、指数低通滤波器（ELPF）。这三种频率域低通滤波器的频率特性比较如图4-27所示。 

![image-20230328171755708](https://mypic-1312707183.cos.ap-nanjing.myqcloud.com/image-20230328171755708.png)

图4-27 ILPF、BLPF、ELPF特征曲线
(a) ILPF特征曲线;
(b) BLPF特征曲线;
(c) ELPF特征曲线 

3. 多幅图像平均法

一幅有噪声的图像 $f(x, y)$, 可以看作是由原始无噪声图像 $g(x, y)$} 和噪声 $n(x, y)$ 叠加而成（加性噪声），即

$$
f(x, y)=g(x, y)+n(x, y)\tag{4-26}
$$

若叠加在图像上的噪声 $n(x, y)$ 是非相关、具有零均值的随机噪 声时，那么，把针对一目标物(景物)在相同条件下, 把作M次重复 摄取的图像相加, 取平均值作为输出图像，便可对图像中的噪声 进行平滑。 

多幅图像的平均输出图像的期望值是无噪声的理想图像 $g(x$,y)。需要注意的是对多幅图像平均, 要求多幅图像之间相互对准,而大多数图像要做到严格对准是相当困难的。多幅图像取平均处理常用于摄像机的视频图像中, 用以减少电视摄像机光电摄像管或CCD器件所引起的噪声。这是对同一景物连续摄取多幅图像并数字化, 再对多幅图像平均, 一般选用8幅图像取平均。这种方法在实际应用中的难点是如何把多幅图像配准起来, 以便使相应的像素能正确地对应排列。

要明确的一点是：没有一种十全十美的去除噪声方法, 应根据处理目的，通过实际试验选择合适的方法。

